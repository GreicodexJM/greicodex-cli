{{ if eq .Stack.ci "Bitbucket Pipelines" }}
image: python:3.9

pipelines:
  default:
    - step:
        script:
          - pip install -r requirements.txt.tmpl
          - flake8 .
          - pytest
          - curl -L https://github.com/zricethezav/gitleaks/releases/download/v8.15.2/gitleaks_8.15.2_linux_x64.tar.gz -o gitleaks.tar.gz
          - tar -xzf gitleaks.tar.gz
          - ./gitleaks detect --source . --verbose
{{ end }}

{{ if eq .Stack.ci "Bitbucket Pipelines" }}
image: php:8.2

pipelines:
  default:
    - step:
        script:
          - apt-get update && apt-get install -y unzip
          - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
          - composer install
          - vendor/bin/phpcs --standard=PSR12 src tests
          - vendor/bin/phpunit
          - curl -L https://github.com/zricethezav/gitleaks/releases/download/v8.15.2/gitleaks_8.15.2_linux_x64.tar.gz -o gitleaks.tar.gz
          - tar -xzf gitleaks.tar.gz
          - ./gitleaks detect --source . --verbose
{{ end }}
